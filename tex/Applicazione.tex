\chapter{L'Applicazione}
	Per avere un confronto più significativo, il tutore aziendale ci ha proposto
	la realizzazione di un'applicazione che interagisse, in maniera sostanziale,
	con le funzionalità offerte dal dispositivo in modo da poter valutare meglio
	la potenzialità delle API offerte dai due framework in analisi.
	
	L'applicazione che ci è stata commissionata permette all'utente di segnalare 
	problemi di degrado ambientale con immagini e testo georeferenziati.
	In particolare l'applicazione inizialmente doveva permette all'utente di:
	\begin{itemize}
		\item registrarsi nel sistema al primo avvio e di autenticarsi in quelli
		      successivi;
		\item visualizzare su una mappa le proprie segnalazioni e quelle inviate
		      degli altri utenti;
		\item comporre e inviare su un server una nuova segnalazione
		      georeferenziata inserendo una descrizione testuale e una foto del
		      degrado scattata con il dispositivo;
		\item visualizzare una lista riassuntiva delle proprie segnalazioni
		      inviate;
		\item scegliere un segnalazione e visualizzarne i dettagli.
	\end{itemize}
	Durante la fase di sviluppo però, in occasione della revisione periodica del
	nostro lavoro svolto, sono state richieste nuove funzionalità aggiuntive; in
	particolare ci è stato chiesto di aggiungere:
	\begin{itemize}
		\item una lista generale che mostrasse le ultime segnalazioni inviate da
		      qualsiasi utente;
		\item un meccanismo di salvataggio locale delle proprie segnalazioni e
		      di tutte quelle visualizzate in dettaglio permettendo così
		      all'applicazione un parziale funzionamento anche in assenza di
		      connessione Internet;
		\item la possibilità di ritrovare sulla mappa una segnalazione partendo
		      dalla visualizzazione dei suoi dettagli.
	\end{itemize}
	
	La registrazione e l'autenticazione dell'utente sul server doveva avvenire 
	utilizzando come credenziali di accesso il codice IMEI o il numero di
	telefono, che dovevano essere letti automaticamente dall'applicazione,
	senza necessità d'interazione con l'utente. Abbiamo però deciso, inoltre, di
	dare all'utente, che si sta registrando, la possibilità di scegliersi un
	``nickname'' univoco\footnote{Il controllo dell'univocità è stato demandato
	al lato server e verrà descritto più in dettaglio nella sezione apposita.}
	e di inserire il proprio indirizzo e-mail con l'idea di aggiungere
	successivamente queste informazioni in tutte le sue segnalazioni; in questo
	modo un altro utente che visualizza una certa segnalazione può vedere chi
	l'ha realizzata e, se vuole, sarà in grado di contattarlo tramite posta
	elettronica. Per semplicità abbiamo deciso che una volta scelto il nickname
	questo sarà permanente, diversamente abbiamo aggiunto nell'applicazione una
	schermata tramite la quale sarà possibile aggiornare il proprio indirizzo
	e-mail.
	
	L'applicazione, come ovvio, sarà composta di una parte client e di una parte
	server. Il lato client è la parte dove si concentrano i nostri studi e dove
	mostreremo come sono state implementate le funzionalità richieste
	utilizzando i due framework presi in esame. L'analisi del lato server non
	è scopo di questa attività di tirocinio e quindi ne daremo solo una
	semplice descrizione indicando il modo di funzionamento e le tecnologie
	impiegate, nonché il modo in cui è stato realizzato.
	
	\section{Lato Server}
		Lo scopo principale del lato server di questa applicazione è quello di
		gestire un database che andrà a contenere tutte le segnalazioni inviate
		dagli utenti che vi interagiranno attraverso il lato client. Il
		database dovrà essere in grado di rispondere a query riguardanti
		certamente le coordinate geografiche, ma anche i nickname e la data e
		ora delle varie segnalazioni. Un secondo compito importante che dovrà
		svolgere sarà quello di gestire le identità dei diversi utenti e di
		controllare l'univocità del nickname utilizzato in fase di
		registrazione.
		
		Una caratteristica in più che non era richiesta ma che ci sembrava
		opportuno avere era l'indipendenza della realizzazione del server
		rispetto ai due framework utilizzati nell'implementare il lato client.
		In questo modo entrambe le implementazioni del lato client avrebbero
		dialogato con la stessa implementazione del lato server.
		
		Per la realizzazione di tutto questo, dopo una fase di ricerca, abbiamo
		mirato a due prodotti open source vista la loro semplicità d'uso:
		Apache CouchDB\texttrademark{} e Node.js.
		\begin{description}
			\item[Apache CouchDB\texttrademark{}] è un DBMS (database-management
				system) document-o\-rien\-ted accessibile mediante API RESTful\footnote{Il termine è usato
				per descrivere un'interfaccia che trasmette dati su HTTP. Per una
				descrizione più esaustiva vedere
				\url{http://it.wikipedia.org/wiki/Representational_State_Transfer}}
				con scambio di dati in formato \js{} Object Notation (JSON). Questa
				caratteristica permette di eseguire facilmente operazioni sul database
				indipendentemente dal linguaggio usato per realizzare l'applicazione.
				
				Un database document-oriented è composto da una serie di documenti
				``auto-contenenti'', nei quali vengono inseriti dati, appunto, nel formato 
				JSON. Questo significa che il documento in
				questione è memorizzato nel documento stesso anziché in una tabella
				come avviene nei database relazionali. Infatti in Apache CouchDB\texttrademark{}
				non esistono tabelle, righe, colonne e relazioni tra i
				documenti; è quindi possibile, ad esempio, aggiungere un nuovo
				campo ad un documento senza influire negativamente sugli altri.
				
				Ogni documento può contenere tipi di dato, come stringhe 
				di testo, numeri e valori booleani, ma anche allegati multimediali, 
				questo ci ha permesso di inserire le immagini e i dati di una 
				segnalazione all'interno di un singolo documento.
				Nella sua versione pura CouchDB non permette di eseguire interrogazioni 
				su coordinate geografiche. Per sopperire a questa mancanza abbiamo 
				utilizzato un'estensione chiamata GeoCouch\footnote{La documentazione 
				è disponibile sul sito \url{https://github.com/couchbase/geocouch/}}.
			\item[Node.js] è una piattaforma realizzata sul motore \js{} V8 di
				Google Chrome per la realizzazione facile e veloce di
				applicazioni di rete. La potenza di questa piattaforma è anche
				nel fatto che è supportata da una enorme quantità di moduli
				che permettono di realizzare con poco codice applicazioni piuttosto
				complesse. In più, come Apache CouchDB\texttrademark{}, tutto 
				questo è open source.
				Node.js è stato usato per creare un semplice web server 
				che, comunicando col database CouchDB, sia in grado di eseguire la 
				registrazione di un utente.
		\end{description}
		
		Apache CouchDB\texttrademark{} è stato quindi utilizzato come database 
		per le segnalazioni e per gli utenti.
		Il primo problema che ci siamo trovati a dover gestire è stata la gestione 
		registrazione e autenticazione degli utenti. CouchDB fornisce la 
		possibilità di creare tre tipi diversi di utente:
		\begin{itemize}
			\item membri del database
			\item amministratori del database
			\item amministratori del server
		\end{itemize}
		I membri del database sono definiti per database e possono: leggere tutti
		i tipi di documenti dal DB, scrivere ed editare documenti 
		(tranne per i design documents).

		Gli amministratori del database sono definiti per DB e hanno tutti i 
		privilegi dei membri più: scrivere ed editare i design documents, 
		aggiungere\/rimuovere altri amministratori e membri del DB. 
		Non può però creare e/o cancellare un DB.

		Gli amministratori del server hanno tutti i privilegi.
		
		Avevamo quindi di fatto tre possibilità:
		\begin{enumerate} 
			\item creare un utente amministratore del server, un'utente amministratore 
				del database, e al primo avvio dell'app usare codice IMEI (o numero di telefono) 
				sia come nome utente che come password, per far diventare l'utente un 
				membro del database (con la conseguenza che ad ogni avvio dell'app 
				sia necessaria un'autenticazione, che comunque potrebbe essere 
				trasparente all'utente).
			\item creare un utente amministratore del server e un utente amministratore 
				del database, lasciando però la possibilità di accesso al database 
				come utenti anonimi, e usare il codice IMEI (o numero di telefono) 
				semplicemente come valore di un campo ``utent'' nel documento che 
				rappresenta la segnalazione. In questo modo solo l'utente amministratore 
				del server sarebbe stato in grado di eliminare il database, e solo 
				l'utente amministratore del database avrebbe potuto modificare il 
				design document, mentre non sarebbe stata necessaria nessuna 
				autenticazione per leggere e scrivere segnalazioni.
			\item non creare nessun account e quindi lasciare il server accessibile 
				da chiunque. Come al punto 2 il codice IMEI (o il numero di telefono) 
				sarebbe stato usato semplicemente come valore di un campo ``utente''
				nel documento che rappresenta la segnalazione
		\end{enumerate}
		In accordo col tutore aziendale abbiamo deciso di adottare la prima soluzione, 
		anche per rendere l'applicazione più vicina a quelle che si trovano sul 
		mercato; sarebbe stato infatti poco sicuro lasciare l'accesso al server 
		e/o al database aperto a qualsiasi utente esterno.
		
		I membri di un database devono essere inseriti in un particolare database 
		fornito da CouchDB, il cui nome è _users\footnote{Volendo è possibile 
		configurare CouchDB per modificare tale nome.}. In questo DB ogni documento 
		rappresenta un utente e deve contenere un nome utente e una password da 
		usare come credenziali di autenticazione; inoltre è possibile aggiungervi 
		dei campi pubblici, ovvero dei campi che al contrario di nome utente e 
		password saranno visibili agli altri utenti contenuti nel database _users.
		E' stata questa caratteristica a permetterci di rendere pubblici il nickname 
		l'indirizzo mail.
		
		CouchDB offre vari sistemi di autenticazione, per semplicità abbiamo scelto 
		di usare il Basic Access Authentication\footnote{}; in questo modo il passaggio delle 
		credenziali di accesso al database da client a server avviene attraverso 
		l'url della richiesta HTTP come nell'esempio: 
		\begin{lstlisting}[language=HTTP]
		http://username:password@www.servercouchdb.com/database
		\end{lstlisting}
		oppure usando il campo Authorization dell'header della richiesta HTTP 
		come nell'esempio 
		\begin{lstlisting}[language=HTTP]
		Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQK
		\end{lstlisting}
		dove dXNlcm5hbWU6cGFzc3dvcmQK è la codifica base64 della stringa 
		``username:password''.
		
		
	\section{Lato Client}
		descrizione funzionalità e struttura applicazione. per ogni funzionalità
		si mostra il confronto tra i due framework. In questa sezione, se 
		necessario, si inseriranno qualche screenshot delle 2 app.
